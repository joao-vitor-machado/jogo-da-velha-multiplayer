<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="../../shared/assets/normalize.css">
    <link rel="stylesheet" href="../../shared/assets/button.css">
    <link rel="stylesheet" href="./style.css">
    <title>Tela de Jogo</title>
</head>

<body>
    <header>
        <img src="../../shared/imgs/logo.png" alt="" class="logo-header">
        <div class="player">
            <h1>JOGADOR</h1>
            <img id="img-id-player" src="../../shared/imgs/x.svg" alt="jogador-img" srcset="" height="150vh">
            <h1>JOGA</h1>
            <h2 id="vitoria"></h2>
        </div>
    </header>
    <section>
        <table>
            <tr>
                <td id="0" ></td>
                <td id="1" ></td>
                <td id="2" ></td>
            </tr>
            <tr>
                <td id="3" ></td>
                <td id="4" ></td>
                <td id="5" ></td>
            </tr>
            <tr>
                <td id="6" ></td>
                <td id="7" ></td>
                <td id="8" ></td>
            </tr>
        </table>



    </section>
    <div class="button button-close-conec">
        <a href="../index.html">
            <span>Sair</span>
        </a>
    </div>

    <script src="./def_jogador.js"></script>
    <script src="../../../Controller/playValidator.js"></script>
    
    <script>
        const ws = new WebSocket("ws://localhost:7890");

        ws.addEventListener("open", () => { //ao abrir a conexão o código abaixo será executado

            var celulas = document.querySelectorAll("section table tr td");
            celulas.forEach(celula => {
                //adiciona um eventListener para cada uma das células
                celula.addEventListener("click", () => {
                    ({ linha, coluna } = posicaoToObj(parseInt(celula.id))); // transforma em obj
                    ws.send( // transforma em JSON e envia pro server
                        JSON.stringify({
                            linha: linha,
                            coluna: coluna
                        })
                    )
                })
            });

            var botoesFecharSessao = document.querySelectorAll(".button-close-conec");
            botoesFecharSessao.forEach(btn => {
                btn.addEventListener("click", ()=>{
                ws.close();
            });
            });

            
            ws.addEventListener("message", message => { // define o que acontece quando o computador recebe uma mensagem do server 
                json = message.data;
                mensagem = JSON.parse(json); // transforma o json em um obj

                console.log(mensagem)

                if(mensagem.resultado){ // se o objeto tiver apenas uma propriedade resultado
                    console.log(mensagem.resultado)
                    mostrarPopup(parseInt(mensagem.resultado));
                }else if(mensagem.linha != null && mensagem.coluna != null && mensagem.jogador != null) // se o objeto tiver linha, coluna e jogador diferentes de null, ele efetua a jogada
                {   
                    jogada(mensagem.linha, mensagem.coluna, mensagem.jogador);
                }else if(mensagem.jogadorInicial){ // ainda está sendo trabalhado
                    verificarJogador(mensagem.jogadorInicial);
                }
            })
        })
    </script>

    <script src="./popup.js"></script>
</body>

</html>